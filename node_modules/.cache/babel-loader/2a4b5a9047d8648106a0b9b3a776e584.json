{"ast":null,"code":"import axios from 'axios';\nimport { createAsyncThunk } from '@reduxjs/toolkit';\nimport { setUser } from './Auth-slice';\n\n// Set the base URL to the root of your API\naxios.defaults.baseURL = 'http://localhost:4040';\nconst setAuthToken = token => {\n  if (token) {\n    axios.defaults.headers.common.Authorization = `Bearer ${token}`;\n  } else {\n    delete axios.defaults.headers.common.Authorization;\n  }\n};\n\n// Login action\nconst logIn = createAsyncThunk('auth/logIn', async (credentials, _ref) => {\n  let {\n    rejectWithValue,\n    dispatch\n  } = _ref;\n  try {\n    const {\n      data\n    } = await axios.post('/auth/login', credentials);\n    setAuthToken(data.token);\n    dispatch(setUser(data.user));\n    return data;\n  } catch (error) {\n    return rejectWithValue(error.response.data);\n  }\n});\n\n// Logout action\nconst logOut = createAsyncThunk('auth/logOut', async (_, _ref2) => {\n  let {\n    rejectWithValue\n  } = _ref2;\n  try {\n    await axios.post('/auth/logout');\n    setAuthToken(null);\n  } catch (error) {\n    return rejectWithValue(error.response.data);\n  }\n});\n\n// Fetch current user action\nconst fetchCurrentUser = createAsyncThunk('auth/fetchCurrentUser', async (_, _ref3) => {\n  let {\n    getState,\n    rejectWithValue\n  } = _ref3;\n  const state = getState();\n  const persistedToken = state.auth.token;\n  if (!persistedToken) {\n    return rejectWithValue('No token found');\n  }\n  try {\n    setAuthToken(persistedToken);\n    const {\n      data\n    } = await axios.get('/auth/current');\n    return data;\n  } catch (error) {\n    return rejectWithValue(error.response.data);\n  }\n});\n\n// Register user action\nconst registerUser = createAsyncThunk('auth/registerUser', async (userData, _ref4) => {\n  let {\n    rejectWithValue,\n    dispatch\n  } = _ref4;\n  try {\n    const {\n      data\n    } = await axios.post('/auth/register', userData);\n    setAuthToken(data.token);\n    dispatch(setUser(data.user));\n    return data;\n  } catch (error) {\n    console.error('Registration error:', error.response.data);\n    return rejectWithValue(error.response.data.message || 'Registration failed');\n  }\n});\n\n// Export actions\nexport { logIn, logOut, fetchCurrentUser, registerUser };","map":{"version":3,"names":["axios","createAsyncThunk","setUser","defaults","baseURL","setAuthToken","token","headers","common","Authorization","logIn","credentials","_ref","rejectWithValue","dispatch","data","post","user","error","response","logOut","_","_ref2","fetchCurrentUser","_ref3","getState","state","persistedToken","auth","get","registerUser","userData","_ref4","console","message"],"sources":["C:/hw02-express/expense-tracker/src/redux/Auth/Auth-operations.js"],"sourcesContent":["import axios from 'axios';\r\nimport { createAsyncThunk } from '@reduxjs/toolkit';\r\nimport { setUser } from './Auth-slice';\r\n\r\n// Set the base URL to the root of your API\r\naxios.defaults.baseURL = 'http://localhost:4040';\r\n\r\nconst setAuthToken = (token) => {\r\n  if (token) {\r\n    axios.defaults.headers.common.Authorization = `Bearer ${token}`;\r\n  } else {\r\n    delete axios.defaults.headers.common.Authorization;\r\n  }\r\n};\r\n\r\n// Login action\r\nconst logIn = createAsyncThunk(\r\n  'auth/logIn',\r\n  async (credentials, { rejectWithValue, dispatch }) => {\r\n    try {\r\n      const { data } = await axios.post('/auth/login', credentials);\r\n      setAuthToken(data.token);\r\n      dispatch(setUser(data.user));\r\n      return data;\r\n    } catch (error) {\r\n      return rejectWithValue(error.response.data);\r\n    }\r\n  }\r\n);\r\n\r\n// Logout action\r\nconst logOut = createAsyncThunk(\r\n  'auth/logOut',\r\n  async (_, { rejectWithValue }) => {\r\n    try {\r\n      await axios.post('/auth/logout');\r\n      setAuthToken(null);\r\n    } catch (error) {\r\n      return rejectWithValue(error.response.data);\r\n    }\r\n  }\r\n);\r\n\r\n// Fetch current user action\r\nconst fetchCurrentUser = createAsyncThunk(\r\n  'auth/fetchCurrentUser',\r\n  async (_, { getState, rejectWithValue }) => {\r\n    const state = getState();\r\n    const persistedToken = state.auth.token;\r\n\r\n    if (!persistedToken) {\r\n      return rejectWithValue('No token found');\r\n    }\r\n\r\n    try {\r\n      setAuthToken(persistedToken);\r\n      const { data } = await axios.get('/auth/current');\r\n      return data;\r\n    } catch (error) {\r\n      return rejectWithValue(error.response.data);\r\n    }\r\n  }\r\n);\r\n\r\n// Register user action\r\nconst registerUser = createAsyncThunk(\r\n  'auth/registerUser',\r\n  async (userData, { rejectWithValue, dispatch }) => {\r\n    try {\r\n      const { data } = await axios.post('/auth/register', userData);\r\n      setAuthToken(data.token);\r\n      dispatch(setUser(data.user));\r\n      return data;\r\n    } catch (error) {\r\n      console.error('Registration error:', error.response.data);\r\n       return rejectWithValue(error.response.data.message || 'Registration failed');\r\n    }\r\n  }\r\n);\r\n\r\n// Export actions\r\nexport { logIn, logOut, fetchCurrentUser, registerUser };\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}